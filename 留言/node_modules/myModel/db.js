//db工具类，用于操作数据库的增删改查
var mongoClient = require("mongodb").MongoClient;
var ObjectId = require("mongodb").ObjectID;

//获取链接
var url = "mongodb://localhost:27017/liuyan";
function getConnection(callback){
    mongoClient.connect(url,function(err,db){
        if(err){
            console.log("连接失败");
            callback(err,null);
            return;
        }
        console.log("连接成功");
        callback(null,db);
    });
}
//增
exports.add = function(collectionName,jsonData,callback){
    //获取链接
    getConnection(function(err,db){
        if(err){//如果失败
            return;
        }
        //连接成功
        //获取集合
        var collection = db.collection(collectionName);
        //插入数据
        collection.insertOne(jsonData,function(err,result){
            callback(err,result);
        });
        db.close();
    });
}
exports.find = function(collection,json,callback){
    getConnection(function(err,db){
        db.collection(collection).find(json).toArray(function(err,docs){
            callback(err,docs);
        });
        db.close();
    });
}
//删
//改
//查
//db.c.find({}).skip(0).limit(3).sort({})
//collection:查找的集合对象
//json:查询的条件
exports.findByPage = function(collection,json,C,D){
    //console.log(collection,json,C,D);
    var skipPage = 1;
    if(arguments.length==3){
        var callback = C;
    }else if(arguments.length==4){
        skipPage = C||1;
        var callback = D;
    }else{
        throw new Error("参数个数错误");
        return;
    }
    var skipNumber = (skipPage-1)*3;
    //console.log(skipNumber);
    getConnection(function(err,db){
        db.collection(collection).find(json).skip(skipNumber).limit(3).sort({time:-1}).toArray(function(err,docs){
            callback(err,docs);
        })
        db.close();
    });

}








